<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Cadastro</title>
  <link rel="stylesheet" href="/Site/public/css/empresas.css" />
</head>

<body>


  <div class="empresa">
    <div class="container">
      <div class="card">
        <div class="card-cadastro-empresa">
          <div class="formulario">
            <h2>Cadastro de Empresas</h2>
            <div class="campo">
                <input id="cnpj_input" type="text" placeholder="CNPJ">
              </div>
            <div class="campo">
              <input id="corporate_name_input" type="text" placeholder="Nome da empresa">
            </div>
            <div class="campo">
              <input id="address_input" type="text" placeholder="Endereço">
            </div>
            <button class="botao" onclick="cadastrarEmpresa()">Adicionar empresa</button>
            <button class="botao" onclick="editarEmpresa()">Editar empresa</button>
            <button class="botao" onclick="excluirEmpresa()">Excluir empresa</button>
          </div>
        </div>
      </div>
    </div>
  </div>

</body>

</html>

<script>

  function cadastrarEmpresa() {

    //Recupere o valor da nova input pelo nome do id
    // Agora vá para o método fetch logo abaixo
    var corporateNameVar = corporate_name_input.value;
    var addressVar = address_input.value;
    var cnpjVar = cnpj_input.value;


    // Verificando se há algum campo em branco
    if (
      corporateNameVar == "" ||
      addressVar == "" ||
      cnpjVar == ""
    ) {
      
      alert("Preencha todos os campos")
      return false;
    }

    if(cnpjVar.length != 14){
        alert("CNPJ deve possuir 14 digitos")
        return false
    }

    // Enviando o valor da nova input
    fetch("/dashboard/cadastrarEmpresa", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        // crie um atributo que recebe o valor recuperado aqui
        // Agora vá para o arquivo routes/dashboard.js
        corporateNameServer: corporateNameVar,
        addressServer: addressVar,
        cnpjServer: cnpjVar,
      }),
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {
          alert("Empresa cadastrada com sucesso!")
          limparCampos();
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });

    return false;
  }

  function excluirEmpresa() {

//Recupere o valor da nova input pelo nome do id
// Agora vá para o método fetch logo abaixo
var cnpjVar = cnpj_input.value;


// Verificando se há algum campo em branco
if (
  cnpjVar == ""
) {
  
  alert("Preencha o cnpj")
  return false;
}

if(cnpjVar.length != 14){
    alert("CNPJ deve possuir 14 digitos")
    return false
}

// Enviando o valor da nova input
fetch("/dashboard/excluirEmpresa", {
  method: "DELETE",
  headers: {
    "Content-Type": "application/json",
  },
  body: JSON.stringify({
    // crie um atributo que recebe o valor recuperado aqui
    // Agora vá para o arquivo routes/dashboard.js
    cnpjServer: cnpjVar
  }),
})
  .then(function (resposta) {
    console.log("resposta: ", resposta);

    if (resposta.ok) {
      alert("Empresa deletada com sucesso!")
      limparCampos();
    }
  })
  .catch(function (resposta) {
    console.log(`#ERRO: ${resposta}`);
  });

return false;
}

  function limparCampos() {
    corporate_name_input.value = ""
    address_input.value = ""
    cnpj_input.value = ""
  }
</script>